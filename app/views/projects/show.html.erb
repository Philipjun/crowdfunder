<%= link_to "Back to Projects", projects_url %><br/>
<%= Time.now %>

<div class="small-3 small-centered columns">
	<h1><%= @project.title %> </h1>
</div>
<div class = "row">
	<div class="large-6 columns">
		Description: <%= @project.description %> <br />
		Goal number: <%= @project.goal %> <br />
		Total pledged: 
		<div id="pledgeTotal">			
			<% if Pledge.first == nil %>

				<%= 0 %>	
			<% elsif @project.pledge_total == nil%>
				<% total = 0 %>
			<% else %>
				<% total = @project.pledge_total %>
			<% end %>

			<% @project.breakpoints.each do |breakpoint| %>
				<% total += breakpoint.pledge * breakpoint.pledges.count %>  
			<% end %>
			
			<%= total %>
			

		</div>

		Start Date: <%= @project.start_date %> <br/>
		End Date: <%= @project.end_date %>

		<div id= "timeRemaining">
			<% time_left = (@project.end_date - @project.start_date)/(86400) %>
			There is <%= time_left %> days remaining to back this project!
		</div>

	</div>

	<div class ="large-6 columns">

		<!-- List tiers of breakpoint -->
		<% @project.breakpoints.each do |breakpoint| %>
		<div class= "pledge">
			<h2><%= breakpoint.pledge_title %></h2>
			<%= breakpoint.info %>
			<p id="amount"><%= breakpoint.pledge %></p><br/>
		
			<%= form_for [@project, @pledge], :remote => true, :html => {:class => "pledgeSubmit"} do |f| %>
			<%= f.submit "Pledge", class: "button" %>
			<%= f.hidden_field :project_id, :value => @project.id %>
			<%= f.hidden_field :breakpoint_id,  :value => breakpoint.id %>
			<% end %>
		</div>
		<% end %>
		<%= form_for [@project, @breakpoint] do |f| %>
		<div class= "field">
			<%= f.label :pledge_title%><br/>
			<%= f.text_field :pledge_title%>
		</div>
		<div class= "field">
			<%= f.label :info%><br/>
			<%= f.text_area :info%>
		</div>
		<div class= "field">
			<%= f.label :pledge%><br/>
			<%= f.number_field :pledge%>
		</div>
		<div class= "action" id="b1s">
			<%= f.submit "Submit", class: "button" %>
		</div>
		<% end %>
	</div>
	<% if current_user %>

	<h3>Comments</h3>

		<p>Comments for <%= @project.title %></p>

		<% @project.comments.each do |x| %>
		<p>
			<%= x.comment_text %>
			<br>
				<% if x.user_id != nil %>
				<em> by <%= x.user.email %></em>
				Added on: <%= x.created_at %>
				<% end %>
		</p>
		<% end %>
	<h4>New Comment</h4>

		<%= form_for [@project, @comment] do |f| %>
			<div class="field">
				<%= f.label :comment_text %><br/>
				<%= f.text_area :comment_text %>
			</div>
			<div class= "action" id="b1s">
			<%= f.submit "Submit", class: "button" %>
			</div>
		<% end %>

	<% else %>
		<p>Please <%= link_to "log in", new_session_path %> to add a comment.</p>
	<% end %>
</div>


